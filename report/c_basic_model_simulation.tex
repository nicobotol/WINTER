\newpage
\section{Analysis of the dynamic behavior of the reference wind turbine}\label{sec:c_basic_model_simulation}
In this section the developed emulator is validated. First of all the algorithm based on the mechanical power maximization is tested applying different wind speed conditions. Secondly, the controller based on the generator power maximization is compared with the first one under constant and variable speeds. The comparison of the optimal gain with some other non-optimal ones is also shown. As third step, the test of the IMM based control is performed on an example case. 
%   ____       _                                    
%  |  _ \ ___ | |_ ___  _ __   _ __ ___   __ ___  __
%  | |_) / _ \| __/ _ \| '__| | '_ ` _ \ / _` \ \/ /
%  |  _ < (_) | || (_) | |    | | | | | | (_| |>  < 
%  |_| \_\___/ \__\___/|_|    |_| |_| |_|\__,_/_/\_\
                                                  
\subsection{Rotor power maximization}
Four tests are here proposed:
\begin{itemize}
  \item Slowly increasing wind ramp
  \item Stochastic wind time series
  \item Disabling of the pitch controller
  \item Stochastic wind time series and different pitching dynamics (i.e. slower or faster than the normal one)
\end{itemize}

\subsubsection{Velocity ramp}
The model is tested providing as wind input a ramp starting at time 0 $\si{\second}$. The parameters that may be changed in the simulation: starting and finishing WSs, time length of the ramp.\\
It is decided to test 3 wind velocity conditions to investigate the three main operating regions. \autoref{tab:simulation_config} reports the configurations of these simulations. 
\begin{table}[!htbp]
    \caption{Configuration parameters for the simulation}
    \centering
    \begin{tabular}{lcccc}
    \toprule
      Simulation & Regime  & WS & Ramp length \\ 
       & & $\left[\si{\meter\per\second}\right]$ & $\left[\si{\second}\right]$ \\ \midrule       
       I & Below & 4-10 & 2000  \\
       II & Below $\rightarrow$ above rated & 10-14 & 2000 \\
       III & Above & 14-20 & 2000  \\
       \bottomrule
    \end{tabular}
    \label{tab:simulation_config}
\end{table}

A post-process check can be done on the powers, in particular that the one provided by the wind is equal to the sum of the one processed by the generator, the rate of variation of the kinetic energy in the inertia and the one lost in damping. In particular the power equations on the rotor side of the transmission can be written starting from \autoref{eq:mech_eq}:
\begin{gather}
    J_{eq}\dot{\omega}_{R} = T_R^R - T_R^G-B_{eq}\omega_R\\
    J_{eq}\dot{\omega}_{R} + T_R^G + B_{eq}\omega^R = T_R^R\\
    \left(J_{eq}\dot{\omega_{R}} + T_R^G + B_{eq}\omega^R\right)\omega^R = \left(T_R^R\right)\omega^R\\
    J_{eq}\dot{\omega_{R}}\omega_{R} + T_R^{G}\omega_{R} + B_{eq}\omega^{R^{2}} = T_R^{R}\omega_{R}\\
    P_{inertia} + P_{generator} + P_{damping} = P_{rotor} 
    \label{eq:power_balance}
\end{gather}

The results of the simulations are reported in \autoref{fig:simulation_1}, \ref{fig:simulation_2}, \ref{fig:simulation_3}. In particular:
\begin{itemize}
  \item \autoref{fig:wind_sim_I}, \ref{fig:wind_sim_II}, \ref{fig:wind_sim_III} report the wind velocity as a function of the simulation time;
  \item \autoref{fig:omega_sim_I}, \ref{fig:omega_sim_II}, \ref{fig:omega_sim_III} are the parametrizations of the rotor rotational speed as function of the WS;
  \item \autoref{fig:omega_full_fedback} is the parametrization of the rotational speed using also the damping term in the feedback line; 
  \item \autoref{fig:power_sim_I}, \ref{fig:power_sim_II}, \ref{fig:power_sim_III} are the parametrizations of the power as function of the WS;
  \item \autoref{fig:pitch_sim_I}, \ref{fig:pitch_sim_II}, \ref{fig:pitch_sim_III} are the parametrizations of the pitch angle as function of the WS;
  \item \autoref{fig:power_check_sim_I}, \ref{fig:power_check_sim_II}, \ref{fig:power_check_sim_III} are the power check, as described in \autoref{eq:power_balance};
  \item \autoref{fig:torque_sim_I} is the generator torque reference as function of the rotor rotational speed.
\end{itemize}

% plots of the results
\input{c_basic_model_results}

The first thing to notice is that the results of this simulation follow the expected static trends. This confirms that the chosen time length scale is sufficiently long to be seen as static from the controller. \\
It could be seen that below rated WS (in the case of control signal using only $K_{opt}$, \autoref{fig:omega_sim_I}) there is a deviation between the rotor speed in static conditions and the one obtained in the simulation. The main source of this mismatch is the damping, because the same error is much reduced when the additional damping term is considered in the power set-point generation (as in \autoref{fig:omega_full_fedback}). The additional difference is due to the inertial terms. 

\subsubsection{Generated wind time series}\label{sec:wind_series_sim}
The model is tested with an input wind time series three times, the first with mean \acrshort{WS} of 6 $\si{\meter\per\second}$, the second with 11.5 $\si{\meter\per\second}$, and the third with 20 $\si{\meter\per\second}$. These values are chosen to test the simulator in the three characteristics wind regimes. In the first simulation the turbulence is chosen to be $\sigma=0.6 \ \si{\meter\per\second}$ while for the other $\sigma=1 \ \si{\meter\per\second}$. The simulation is run for $t=150 \ \si{\second}$ and the results of the last 100 $\si{\second}$ are plotted in order to get rid of the transient behavior. The sampling frequency for the wind series generation is set to be $f_s=50 \ \si{\hertz}$.

The results of this simulation are reported in \autoref{fig:simulation_rand_wind_NPC}, where the wind time series and the parametrizations of some quantities as function of the instantaneous WS are reported on top of the corresponding reference lines obtained by static analysis. Futhermore, the \acrfull{RMS} error between the value of some observed quantities and their static values will be presented in \autoref{tab:RMS_comparison}, where they will be also compared with the results of another similar simulation. \\
What can be seen from the results is that the observed quantities are clustered around the static curve. This is reasonable since if the turbulence were set to 0, then the expected results would have been a point on the static curve corresponding to the investigated WS. It must be highlighted that in these curves the initial transient part has been eliminated in order to have a better visualization. 

\begin{figure}[!htbp]
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_14_56_44fig_wind_TS.eps}
    \caption{Wind time series}
    \label{fig:2023_05_1_00_55_48fig_wind_TS}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_14_57_26fig_pitch_param.eps}
    \caption{Pitch angle time series}
    \label{fig:2023_05_1_00_50_19fig_power_param}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_14_56_58fig_power_param.eps}
    \caption{Input power to the generator}
    \label{fig:2023_05_1_00_51_17fig_omega_param}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_14_57_38fig_omega_param.eps}
    \caption{Rotational speed}
    \label{fig:2023_05_1_00_50_58fig_pitch_param}
  \end{subfigure}
  \caption{Results of simulation with a generated wind series}
  \label{fig:simulation_rand_wind_NPC}
\end{figure}

\subsubsection{Influence of the pitch angle gain scheduling}\label{subsec:gain_scheduling_disabling}
In order to verify the effect of the gain scheduling with respect a fixed gain for the pitch angle controller, three simulations with different WSs are proposed, $V_{10} = 11.5, 15, 20 \ \si{\meter\per\second}$. For each of them four different gains are used. The settings for all of them are reported in \autoref{tab:simulation_config_variable_gains}, \autoref{tab:simulation_config_variable_gains2}, and \autoref{tab:simulation_config_variable_gains3}. \\
In particular, the first and the fourth simulations use the gain scheduling paradigm while the other two have a fixed gains. The specific numerical value chosen in the constant case are representative of two very different regions of the scheduling case since \textit{simulation 2} has values close to the ones used at low WSs, while \textit{3} has value close to the high WSs. 

$\mathbf{V_{10}=11.5 \, ms^{-1}}$\\
The first of the three simulations is run at $V_{10} = 11.5 \ \si{\meter\per\second}$. Here an intermittent activation of the pitching mechanism is expected since the WS fluctuates around its nominal value.\\
\autoref{tab:simulation_config_variable_gains} reports the simulation settings while \autoref{fig:gain_scheduling_time_dependency} reports the time evolution of the pitch angle, rotor rotational speed, and the generator torque obtained from the simulations. 

\begin{table}[!htbp]
  \caption{Configuration parameters for the simulation in \autoref{fig:gain_scheduling_time_dependency}}
  \centering
  \begin{tabular}{ccccc}
  \toprule
    Simulation & $V_{10}$  & $\sigma_{V_{10}}$ & Gains schedule \\ 
     & $\left[\si{\meter\per\second}\right]$ & $\left[\si{\meter\per\second}\right]$ & \\ \midrule       
     1 & 11.5 & 1 & As in \autoref{subsec:gain_schdeuling_aero}  \\
     2 & 11.5 & 1 & $k_p = 2 \ \mesunt{\second}$, $k_i=0.9 \ [-]$ \\
     3 & 11.5 & 1 & $k_p = 0.25 \ \mesunt{\second}$, $k_i=0.2 \ [-]$  \\
     4 & 11.5 & 1 & As reported in \cite{Olimpo_Anaya‐Lara}  \\
     \bottomrule
  \end{tabular}
  \label{tab:simulation_config_variable_gains}
\end{table}

\begin{figure}[!htbp]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_18_59_44fig_wind_TS.eps}
    \label{fig:fig_wind_15ms}
    \caption{Wind time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_18_59_51fig_pitch_dynamic.eps}
    \caption{Pitch angle time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_18_59_58fig_omega_dynamic.eps}
    \caption{Rotor rotational speed time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_19_00_14fig_torque_dynamic.eps}
    \caption{Torque time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_19_00_04fig_power_dynamic.eps}
    \caption{Power time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_19_00_27fig_generator_power_check.eps}
    \caption{Generator power time series}
  \end{subfigure}
  \caption{Comparison of the simulation with generated time series and three different gain scheduling strategies}
  \label{fig:gain_scheduling_time_dependency}
\end{figure}
After the simulation and in order to evaluate it quantitatively, the RMS error between the steady state quantities (i.e. the last 40 seconds of the simulation) and the corresponding expected nominal values above rated WS are computed, and reported in \autoref{tab:res_variable_gains}.

In this simulation these error metrics are not so representative since the wind is not always above the rated one and therefore the corresponding power, torque and rotational speed are not always expected to be reached. They are reported anyway in order to be then compared with the simulations proposed later on.  

\begin{table}[!htbp]
  \caption{RMS error of the results obtained with setting in \autoref{fig:gain_scheduling_time_dependency}}
  \centering
  \begin{tabular}{cccccccc}
    \toprule
      Simulation & \multicolumn{2}{c}{$\omega_R$} & \multicolumn{2}{c}{$P_G$} & \multicolumn{2}{c}{$T_G$} \\ 
       & $\left[\si{\radian\per\second}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\watt}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\newton\meter} \right]$ & $ \% \left[-\right]$ \\ \midrule       
       1 &  0.03 &  3.07 &  0.53  &  5.25  &  0.31  &  3.12 \\
       2 &  0.03 &  2.93 &  0.54  &  5.30  &  0.30  &  3.01 \\
       3 &  0.04 &  4.36 &  0.80  &  7.92  &  0.49  &  4.88 \\
       4 &  0.04 &  3.56 &  0.63  &  6.24  &  0.38  &  3.79 \\
     \bottomrule
  \end{tabular}
  \label{tab:res_variable_gains}
\end{table}

The first two simulations are very close to each other, since the static gain of \textit{sim. 2} is almost the same of the scheduling at rated speed. Furthermore, the results of the fourth simulation are not too different from the first two. Finally, it could be also noticed that the gain in case \textit{3} is very different from the other one, suggesting that this choice is not suitable for this condition. 

$\mathbf{V_{10}=15 \, ms^{-1}}$\\
The second simulation is run with $V_{10}=15 \ \si{\meter\per\second}$, and so the WS is expected to be always above the rated one. The simulation settings are reported in \autoref{tab:simulation_config_variable_gains2}.
\begin{table}[!htbp]
  \caption{Configuration parameters for the simulation in \autoref{fig:gain_scheduling_time_dependency2}}
  \centering
  \begin{tabular}{ccccc}
  \toprule
    Simulation & $V_{10}$  & $\sigma_{V_{10}}$ & Gains schedule \\ 
     & $\left[\si{\meter\per\second}\right]$ & $\left[\si{\meter\per\second}\right]$ & \\ \midrule       
     1 & 15 & 1 & As in \autoref{subsec:gain_schdeuling_aero}  \\
     2 & 15 & 1 & $k_p = 2 \ \mesunt{\second}$, $k_i=0.9 \ [-]$ \\
     3 & 15 & 1 & $k_p = 0.25 \ \mesunt{\second}$, $k_i=0.2 \ [-]$  \\
     4 & 15 & 1 & As reported in \cite{Olimpo_Anaya‐Lara}  \\
     \bottomrule
  \end{tabular}
  \label{tab:simulation_config_variable_gains2}
\end{table}

\autoref{fig:gain_scheduling_time_dependency2} reports the time evolution of the pitch angle, rotor rotational speed, and the generator torque. 

\begin{figure}[!htbp]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_06fig_wind_TS.eps}
    \label{fig:2023_05_9_20_55_30fig_wind_TS}
    \caption{Wind time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_17fig_pitch_dynamic.eps}
    \label{fig:2023_05_9_20_55_30fig_pitch_dynamic}
    \caption{Pitch angle time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_26fig_omega_dynamic.eps}
    \label{fig:2023_05_9_20_55_46fig_omega_dynamic}
    \caption{Pitch angle time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_43fig_torque_dynamic.eps}
    \label{fig:2023_05_9_20_56_15fig_torque_dynamic}
    \caption{Torque time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_34fig_power_dynamic.eps}
    \label{fig:2023_05_9_20_55_59fig_power_dynamic}
    \caption{Power time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_12_07fig_generator_power_check.eps}
    \label{fig:2023_05_20_15_07_04fig_generator_power_check}
    \caption{Generator power time series}
  \end{subfigure}
  \caption{Comparison of the simulation with generated time series and three different gain scheduling strategies}
  \label{fig:gain_scheduling_time_dependency2}
\end{figure}

The \acrshort{RMS} error between the steady state value and the corresponding expected static value is evaluated. The results are reported in the \autoref{tab:res_variable_gains2}.
\begin{table}[!htbp]
  \caption{RMS error of the results obtained with setting in \autoref{fig:gain_scheduling_time_dependency2}}
  \centering
  \begin{tabular}{cccccccc}
    \toprule
      Simulation & \multicolumn{2}{c}{$\omega_R$} & \multicolumn{2}{c}{$P_G$} & \multicolumn{2}{c}{$T_G$} \\ 
       & $\left[\si{\radian\per\second}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\watt}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\newton\meter} \right]$ & $ \% \left[-\right]$ \\ \midrule      
     1 & 0.01 &  1.23 &  0.08  &  0.75  &  0.10  &  1.00 \\
     2 & 0.01 &  0.87 &  0.02  &  0.22  &  0.08  &  0.79 \\
     3 & 0.02 &  2.18 &  0.23  &  2.27  &  0.17  &  1.66 \\
     4 & 0.02 &  1.78 &  0.16  &  1.56  &  0.13  &  1.29 \\
    
     \bottomrule
  \end{tabular}
  \label{tab:res_variable_gains2}
\end{table}

As could be seen from the root mean square errors, using gain scheduling can be beneficial as compared to using fixed pair. In fact, even though \textit{simulation 2} has lowest error value, the ones of \textit{3} are almost double than the \textit{1}. This means that a fixed gain may perform well in a certain wind region (i.e. the one corresponding at the same gain in the scheduling approach) but probably it will underperform in another different from that one.  

$\mathbf{V_{10}=20 \, ms^{-1}}$\\
The last tested \acrshort{WS} is 20 $\si{\meter\per\second}$. The simulation parameters are reported in \autoref{tab:simulation_config_variable_gains3} while the results in \autoref{fig:gain_scheduling_time_dependency3} and \autoref{tab:res_variable_gains3}.

\begin{table}[!htbp]
  \caption{Configuration parameters for the simulation in \autoref{fig:gain_scheduling_time_dependency3}}
  \centering
  \begin{tabular}{ccccc}
  \toprule
    Simulation & $V_{10}$  & $\sigma_{V_{10}}$ & Gains schedule \\ 
     & $\left[\si{\meter\per\second}\right]$ & $\left[\si{\meter\per\second}\right]$ & \\ \midrule       
     1 & 20 & 2.0 & As in \autoref{subsec:gain_schdeuling_aero}  \\
     2 & 20 & 2.0 & $k_p = 2 \ \mesunt{\second}$, $k_i=0.9 \ [-]$ \\
     3 & 20 & 2.0 & $k_p = 0.25 \ \mesunt{\second}$, $k_i=0.2 \ [-]$  \\
     4 & 20 & 2.0 & As reported in \cite{Olimpo_Anaya‐Lara}  \\
     \bottomrule
  \end{tabular}
  \label{tab:simulation_config_variable_gains3}
\end{table}

\begin{figure}[!htbp]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_17fig_wind_TS.eps}
    \caption{Wind time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_27fig_pitch_dynamic.eps}
    \caption{Pitch angle time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_38fig_omega_dynamic.eps}
    \caption{Pitch angle time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_55fig_torque_dynamic.eps}
    \caption{Torque time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_46fig_power_dynamic.eps}
    \caption{Power time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_21_12fig_generator_power_check.eps}
    \caption{Generator power time series}
  \end{subfigure}
  \caption{Comparison of the simulation with generated time series and three different gain scheduling strategies}
  \label{fig:gain_scheduling_time_dependency3}
\end{figure}

\begin{table}[!htbp]
  \caption{RMS error of the results obtained with setting in \autoref{fig:gain_scheduling_time_dependency3}}
  \centering
  \begin{tabular}{cccccccc}
    \toprule
      Simulation & \multicolumn{2}{c}{$\omega_R$} & \multicolumn{2}{c}{$P_G$} & \multicolumn{2}{c}{$T_G$} \\ 
       & $\left[\si{\radian\per\second}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\watt}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\newton\meter} \right]$ & $ \% \left[-\right]$ \\ \midrule        
     1 & 0.01 &  1.17 &  0.07  &  0.66  &  0.10  &  0.96  \\
     2 & 0.01 &  0.91 &  0.03  &  0.29  &  0.08  &  0.81  \\
     3 & 0.02 &  1.80 &  0.19  &  1.84  &  0.14  &  1.42  \\
     4 & 0.02 &  1.69 &  0.16  &  1.61  &  0.13  &  1.28 \\ 
    
     \bottomrule
  \end{tabular}
  \label{tab:res_variable_gains3}
\end{table}

The considerations that can be done on this case are similar to the previous ones. 

\textbf{Parametrization with respect to the WS}\\
Another comparison between the use or not of the gain scheduling may be done repeating the simulations done in \autoref{sec:wind_series_sim} (random WS) but disabling the blade gain scheduling, and letting the gains of the previous \textit{simulation 2} (i.e. $k_p = 2 \ \si{\second}$, $k_i=0.9 \ [-]$). The corresponding results are reported in \autoref{fig:simulation_rand_wind_no_gain_scheduling}.
\begin{figure}[!htbp]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_15_24_55fig_wind_TS.eps}
    \caption{Wind time series}
    \label{fig:2023_05_8_22_43_35fig_wind_TS}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_15_25_29fig_pitch_param.eps}
    \caption{Pitch angle time series}
    \label{fig:2023_05_8_22_44_05fig_pitch_param}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_15_25_02fig_power_param.eps}
    \caption{Input power to the generator}
    \label{fig:2023_05_8_22_44_15fig_power_param}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_15_25_43fig_omega_param.eps}
    \caption{Rotational speed}
    \label{fig:2023_05_8_23_17_57fig_omega_param}
  \end{subfigure}
  \caption{Results of simulation with a generated wind series, no blade gain scheduling}
  \label{fig:simulation_rand_wind_no_gain_scheduling}
\end{figure}

\begin{table}[!htbp]
  \centering
  \caption{RMS errors of the simulations with or without the gain scheduling enabled, alongside their normalized values}
  \label{tab:RMS_comparison}
  \begin{tabular}{cccccccccc}
    \toprule
      $V_0$  & Schedule & $\omega_R$ & $\omega_{R,norm}$ & $P_{G}$ & $P_{G,norm}$ & $T_{G}$ & $T_{G,norm}$ & $\theta$ & $\theta_{norm}$ \\ 
      $\mesunt{\meter\per\second}$ & & $\mesunt{\radian\per\second}$ & $\left[\%\right]$ & $\mesunt{\mega\watt}$ & $\left[\%\right]$ & $\mesunt{\mega\newton\per\meter}$ & $\left[\%\right]$ & $\mesunt{\radian}$ & $\left[\%\right]$ \\ \hline
      \multirow{2}{*}{6.0}  & Enabled &  0.04 &  7.27 & 0.36 & 23.66 & 0.45 & 15.73 & 0.00 &  0.00 \\
      & Disabled &  0.04 &  7.27 & 0.36 & 23.66 & 0.45 & 15.73 & 0.00 &  0.00 \\   \hline
      \multirow{2}{*}{11.5} & Enabled & 0.04 &  3.83 & 0.93 &  9.19 & 0.67 & 6.66 & 0.05 & 148.81 \\
      & Disabled & 0.04 &  3.68 & 0.93 &  9.16 & 0.66 &  6.62 & 0.04 & 144.00 \\ \hline 
      \multirow{2}{*}{20.0} & Enabled & 0.02 &  1.49 &  0.08 & 0.79 &  0.12 & 1.24 & 0.01 & 4.86 \\
      & Disabled & 0.02 &  1.52 & 0.16 &  1.56 & 0.15 &  1.54 & 0.02 &  7.80 \\ \bottomrule
  \end{tabular}
\end{table}

Even though the results of the normalized errors have been reported for completeness in \autoref{tab:RMS_comparison}, their value is not always meaningful, since the normalization has been done for the value of the quantity of interest at the mean wind velocity, while the quantity itself evolves in time during the simulation. This could be well seen in the pitch error, where the high value is due to the fact that the normalization factor is a value close to 0$\si{\degree}$ while the pitch changes around this value.

\textbf{Conclusions}\\
The results obtained in \autoref{subsec:gain_scheduling_disabling} show that the choice of the gain influences the performance of the system. In particular the gain used in the \textit{sim. 3} seems to be always the worst choice in the tested cases. Between the scheduling rule, the one proposed in \autoref{subsec:gain_schdeuling_aero} seems to perform better than the one of \cite{Olimpo_Anaya‐Lara}. Finally, it seems that the constant gain used in \textit{sim. 2} is always the best choice, probably because it is the highest one.% and so produces the response with highest effort.


\subsubsection{Change of the pitching actuator dynamic}\label{subsec:changing_pitch_actuator}  
In this section the dynamic of the pitching mechanism is changed in order to see the different reactivity in the reduction of the power extracted form the wind. It is expected that making the dynamic faster allows to follow the wind fluctuations better at the price of a higher effort, while a slower dynamic will introduce some delay in the control between the incoming speed and the corresponding blade actuation.\\
To validate this hypothesis, three simulations are run with different transfer functions modelling the blade actuator. All of them are run with the usual WS of $V_{10}=15\ \si{\meter\per\second}$ and $\sigma_{V_{10}}=1 \ \si{\meter\per\second}$. \\
The employed transfer functions are reported in \autoref{tab:tf_blade_mechanism}:
\begin{table}[!htbp]
  \caption{Transfer functions modelling the blade actuator}
  \centering
  \begin{tabular}{cc}
  \toprule
    Simulation & G=$\frac{\theta}{\theta^* }$\\\midrule
    1 & $\frac{(2\pi)^2}{s^2+2 \cdot 0.7 \cdot 2\pi+(2\pi)^2}$\\
    2 & $\frac{(2\pi)^2}{s^2+2 \cdot 0.7 \cdot 5\cdot2\pi+(5\cdot2\pi)^2}$\\
    3 & $\frac{(\frac{2\pi}{5})^2}{s^2+2\cdot 0.7 \cdot\frac{2\pi}{5}+(\frac{2\pi}{5})^2}$ \\
    \bottomrule
  \end{tabular}
  \label{tab:tf_blade_mechanism}
\end{table}

It must be noted that Simulation 1 uses the parameters suggested in \cite{Olimpo_Anaya‐Lara}, while 2 has a faster dynamic and 3 a slower than 1.

\begin{figure}[!htbp]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_21_45_29fig_wind_TS.eps}
    \caption{WS time series}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_21_45_38fig_pitch_dynamic.eps}
    \caption{Dynamic of the pitch angle}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_21_45_44fig_omega_dynamic.eps}
    \caption{Rotational speed}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_21_45_51fig_power_dynamic.eps}
    \caption{Power extracted from wind and mech. power at the generator}
  \end{subfigure}
  \caption{Results of simulation with a generated wind series, different blade actuation mechanisms}
  \label{fig:simulation_with_different_pitch_dynamic}
\end{figure}
The results of the simulations are reported in \autoref{fig:simulation_with_different_pitch_dynamic} and they show how the first two mechanisms are pretty similar, meaning that the transfer function suggested by \cite{Olimpo_Anaya‐Lara} and employed in all the other simulation so far does not introduce a great delay in the response of the blade actuation. On the other hand, the third transfer function is slower, meaning that the blades follow the wind change with some delay and for this reason they are rotated by of larger amount.

\subsubsection{Conclusions on the rotor power maximization control}
All the performed tests on the emulator provide results that are compatible with what was expected from them. In particular, its effectiveness in simulating the wind turbine under different types of input winds is proven and also its flexibility in performing different type of analysis such as changing the response of some physical components.

%    ____                           _             
%   / ___| ___ _ __   ___ _ __ __ _| |_ ___  _ __ 
%  | |  _ / _ \ '_ \ / _ \ '__/ _` | __/ _ \| '__|
%  | |_| |  __/ | | |  __/ | | (_| | || (_) | |   
%   \____|\___|_| |_|\___|_|  \__,_|\__\___/|_|   


\subsection{Comparison between rotor and generator power maximization} \label{subsec:validation_control_P_GE}
In this section the control law for the generators's torque based on the generator output power developed in \autoref{subsec:method_control_P_GE} is tested and compared with the one based on the rotor power and developed in \autoref{subsec:torque_reference}, and on the use of gains different from the optimal one. In particular three tests are proposed:
\begin{itemize}
  \item Constant WSs between the cut in and the rated one. Since the difference between the produced powers in the two methods are expected to be small, their representation in a graph parametrized with respect to the WS would be not very clear. For this reason, a finite number of WSs in the below rated region is chosen and the corresponding powers depicted in graphs.
  \item Randomly generated series with mean value between the cut in and the rated one
  \item Ramp WS and constant gains different from the optimal one 
\end{itemize} 
% For this simulation, in order to avoid the interference of the controller not allowing the generator to reach the steady state, this component has been removed and the torque reference value has been directly used into the dynamic equation of the rotor power.
\subsubsection{Constant WS below rated speed}
The generator torque's control law based on the generator has been compared with the one of the rotor, for WS between the cut in and the rated one. A critical condition for this tests is that the rotor rotational speed reaches exactly the one producing the desired tip speed ratio. For this reason, initially the damping reducing the power sent by the rotor to the input of the generator is removed (i.e. $B_{eq}=0 \, \si{\kilo\gram\square\meter\per\second}$). \\
In the simulation, 5 constant WSs have been provided and the corresponding steady state values of mechanical input and electrical output powers to the generator have been evaluated. The results are depicted in \autoref{fig:comparison_control_laws_no_B} while the numerical values and the percentage errors are reported also in \autoref{tab:comp_powers}, where the percentage error is defined as $\Delta P = \frac{P_{Gen.} - P_{Rot.}}{P_{Gen.}}\cdot 100$ where  \textit{Gen.} and \textit{Rot.} states whether the control law uses $K_{opt,GE}$ or $K_{opt}$ respectively.

\begin{figure}[!htbp]
  \centering
  \begin{subfigure}{\columnwidth}
    \includegraphics[width = \columnwidth]{images/vectorial/2023_11_21_11_05_44comparison_control_laws.eps}
    \caption{Simulation without damping. Damping is set $B_{eq}=0$ in the computation of the rated values, in the generation of the reference torque and in the simulation}
    \label{fig:comparison_control_laws_no_B}
  \end{subfigure}
  \begin{subfigure}{\columnwidth}
    \includegraphics[width = \columnwidth]{images/vectorial/2023_11_21_10_17_02comparison_control_laws.eps}
    \caption{Simulation with damping. Damping is set $B_{eq}\ne0$ in the computation of the rated values, in the generation of the reference torque and in the simulation}
    \label{fig:comparison_control_laws_B}
  \end{subfigure}
  \caption{Comparison of input power at the rotor and output power of the generator for the control laws based on the maximization of the power extracted from the resource (called \textit{Rotor} in the legend) and the maximization of the power generated electrical power (called \textit{Generator} in the legend).}
  \label{fig:comparison_control_laws}
\end{figure}

\begin{table}[!htbp]
  \centering
  \caption{Comparison of the static powers. $P_R$ and $P_{GE}$ are the mechanical extracted power and the generator output. \textit{Gen.} and \textit{Rot.} states whether the control law uses $K_{opt,GE}$ or $K_{opt}$ respectively.}
  \begin{tabular}{cc|ccc|ccc}
    \toprule
    & & \multicolumn{3}{c|}{$P_R$} & \multicolumn{3}{c}{$P_{GE}$} \\
    Configuration & $V_{10}$ & Gen.  & Rot.& $\Delta P$  & Gen.  & Rot.& $\Delta P$ \\ 
    & $\mesunt{\meter\per\second}$ & $\mesunt{\mega\watt}$ & $\mesunt{\mega\watt}$ & $\left[\%\right]$ & $\mesunt{\mega\watt}$ & $\mesunt{\mega\watt}$ & $\left[\%\right]$ \\  \midrule
    \input{macro/2023_11_26_14_30_19powers_error_no_B.tex} 
    \input{macro/powers_error_20231121.tex} 
  \end{tabular}
  \label{tab:comp_powers}
\end{table}

It could be seen that, without damping, the control law based on the maximization of the power at the rotor side (called \textit{rotor} in the legend) is always able to provide more mechanical input power, while the one based on the generator electrical output power (called \textit{generator} in the legend) is able to deliver more electrical power for all the velocities except 4 $\si{\meter\per\second}$, where still the difference is very small.  \\
As could be seen in \autoref{fig:comparison_control_laws_B}, when the damping is included into the picture (both in the mechanical equation of the rotor and in the synthesis of the torque reference of the generator) the $P_R$ based on the rotor is higher than the other for all the velocities while the corresponding $P_{GE}$ is always lower except for WS near by rated one.\\
As expected the control based on the generator is less valid for high and low WS, where the assumption of constant parameters is less valid than using the velocity-dependent parameters. 

\subsubsection{Generated wind series}
The implemented control law is also tested for a generic wind series input. The chosen 5 means are 5, 6, 8, 10, 11.4 $\si{\meter\per\second}$ and the turbulence 0.5, 0.5, 1, 1, 1 $\si{\meter\per\second}$. For each wind condition, the simulation is run twice, initially employing a control low based on the generator while later on the rotor. All the simulation lasted 500 $\si{\second}$. The comparison of the results is done calculating the energy extracted by integrating the corresponding power. The results are reported in \autoref{tab:energy_K_opt_comp}. The normalized energy difference is given by:
\begin{equation}
  \Delta E = \frac{E_{Gen.} - E_{Rot.}}{E_{Gen.}}\cdot 100 \, \left[\%\right]
\end{equation}
where $Gen.$ and $Rot.$ identify whether the control law is based on the generator or rotor power maximization respectively.
\begin{table}[!htbp]
  \centering
  \caption{Produced energy in the considered time of $\Delta t$. $E_R$ and $E_{GE}$ are the mechanical extracted energy and the generator output. \textit{Gen.} and \textit{Rot.} states whether the control law uses $K_{opt,GE}$ or $K_{opt}$ respectively. }
  \begin{tabular}{cc|ccc|ccc}
    \toprule
    & & \multicolumn{3}{c|}{$E_R$} & \multicolumn{3}{c}{$E_G$} \\
     $\Delta t \,\mesunt{\second}$ &  $V_{10} \mesunt{\meter\per\second}$ & Gen. $\mesunt{\giga\joule}$ & Rot. $\mesunt{\giga\joule}$ & $\Delta E \, \left[\%\right]$ & Gen. $\mesunt{\giga\joule}$ & Rot. $\mesunt{\giga\joule}$ & $\Delta E \, \left[\%\right]$ \\ \midrule
    \input{macro/2023_11_21_17_31_34energy_K_opt_comp.tex}
  \end{tabular}
  \label{tab:energy_K_opt_comp}
\end{table}

From the results it is well visible what was already described. In fact the control law based on the generator is more effective than the other in producing more energy at the generator side for WSs far from the rated ones. On the other hand, the control law based on the rotor is more effective in extracting mechanical energy from the resource. \\
As final remark it must be remembered that with this type of input WS it is possible that $V_{0,rated}$ may be exceeded in the case of the highest tested speeds, and so also the pitching may have an influence on the results. The explicit impact of this additional controller has not be evaluated because it is difficult to find a representative test case to do so and furthermore it is not crucial to decouple their effect since one is interested in the overall performance of the turbine (i.e. how much energy is produced) without separating the contributions of the different controllers. 

\subsubsection{Use of gains different from the optimal one}\label{subsec:c_different_KoptGE}
Before going on with further analysis it may be interesting to quantify how the turbine's performance changes if using a gain different than the one identified as optimal. In particular, 7 gains factors $K$ around the optimal one are identified by rescaling $K_{opt,GE}$: $K= K_{opt,GE} \cdot \left[0.5, 0.8, 0.9, 1.0, 1.1, 1.2, 1.5\right]$. Then a ramp WS profile between 4 and 11.4 $\si{\meter\per\second}$ lasting 1000 $\si{\second}$ has been applied. The comparison of the results is done again by means of the energy extracted. The numerical results are reported in \autoref{tab:error_KoptGE}. 

\begin{table}[!htbp]
  \caption{Extracted energy by substituting the gain $K_{opt,GE}$ with $K$. $E_R$ and $E_G$ are the energy extracted from the wind and produced by the generator respectively, while $\Delta E_R$ and $\Delta E_G$ are the difference between the energy produced using $K$ and the $K_{opt,GE}$}
  \centering
  \begin{tabular}{ccccccc}
  \toprule
  Int. time $\mesunt{\second}$ & Sim. & $K/K_{opt,GE}$ & $E_R \, \mesunt{\giga\joule}$ & $\Delta E_R \left[\%\right]$ & $E_G \, \mesunt{\giga\joule}$ & $\Delta E_G \left[\%\right]$\\ 
   \midrule
  \input{macro/2023_11_26_17_46_03energy_com_const_gains.tex}
  \end{tabular}
  \label{tab:error_KoptGE}
\end{table}


\begin{figure}[!htbp]
  \centering
  \includegraphics[width=0.7\columnwidth]{images/vectorial/2023_11_14_20_41_07fig_electrical_power_param_zoom.eps}
  \caption{Electrical power output of the generator for different values of $K_{opt,GE}$. The values of $K_{opt,GE}$ used in each simulation are the ones reported in \autoref{tab:error_KoptGE}.}
  \label{fig:Kopt_GE_PGE}
\end{figure}

The resulting static power curves has been reported in \autoref{fig:Kopt_GE_PGE}, from where it could be seen that the gain used in the first three simulations provide a power curve that is quite close to the fourth one (i.e. the optimal) in the below rated region. On the other hand, the power command at rated WS is below the saturation and so, for higher WSs, the rated power is not reached. \\
For what concerns the last three simulations, the error in the below rated region is higher (as could be seen in the figure) but the saturation of the power is reached, and so the overall error is lower than the first cases. \\
From this simulation it can be seen that the optimal gain (as expected) is the one computed previously, and each deviation produces a degradation of the power curve. On the other hand, an overestimation of the gain are less critical than an underestimation, because in the latter case the saturation of the generator's torque command and so the output power is not achieved.

\subsubsection{Conclusions on the generator power maximization control}
Comparing the control laws based on the rotor and on the generator power maximization, it could be seen that the former is not always better than the latter mainly due to the assumption of not having access to a WS estimation and so not being able to schedule the controller according to it. In fact, whenever the mean quantities are close to the WS dependent ones the results are as expected, while they are not when the approximations are less accurate. That being said, the numerical difference between the two methods is not so high and so the use of one controller or the other is not expected to produce a dramatic difference in the operation of the plant.  


%   ___ __  __ __  __ 
%  |_ _|  \/  |  \/  |
%   | || |\/| | |\/| |
%   | || |  | | |  | |
%  |___|_|  |_|_|  |_|
\subsection{Control under parameters uncertainty using the Interactive Multiple Model}
As said before, the IMM requires a-priori definition of the parameters of the models run in each filter. It could be easily understood how the choice of these parameters is crucial for letting the algorithm work properly. In fact if the true model is in the considered set the algorithm will converge to it, otherwise it will move towards the most similar one, that may be \textit{close enough} or not according to the design choice.\\
To make the problem closer to a real scenario, the presence of a measurement instrument for the rotational speed has been considered by means of adding a random white noise to the rotational speed signal. This is taken into account both in the simulation with the IMM and in the one with the constant gain method when the two are compared. The damping compensation term on the torque reference generation is present in both the simulations.\\
In this example, three models are considered, as given in \autoref{tab:models_parameters}:
\begin{table}[!htbp]
  \centering
  \caption{Parameters of the models run in the filters. $\rho_j$ and $K_{opt,GE,j}$ are the air density and the value of the feedback gain used in each of the models, while $\rho$ and $K_{opt,GE}$ are their nominal values of 1.225 $\si{\kilo\gram\per\cubic\meter}$ and $1.093\cdot10^{7} \, \si{\newton\meter\square\second}$.}
  \begin{tabular}{ccc}
    \toprule
    Model \textit{j} & $\frac{\rho_j}{\rho}$ & $\frac{K_{opt,GE,j}}{K_{opt,GE}}$  \\
    \midrule
    1 & 0.8 & 0.8\\
    2 & 1 & 1\\
    3 & 1.2 & 1.2\\
    \bottomrule
  \end{tabular}
  \label{tab:models_parameters}
\end{table}

The choice of the number of models must be a trade off between the computational cost of having many of them and the possible poor estimation accuracy of having only few. In this case three models have been chosen to given an example of the algorithm, but also the real injected density change in the simulation has been tailored to be reasonably close to the chosen models.  

The covariance matrices of the process $Q$ and the measurement noises $W$, and the mode transition matrix $\Pi$ are:
\begin{gather}
  Q = \begin{bmatrix}
    \sigma_{\tilde{T}_R}^2 & 0 \\
    0 & \sigma_v^2
  \end{bmatrix} =
  \begin{bmatrix}
    \left(\frac{0.05 P_R}{3\omega_R}\right)^2 & 0 \\
    0 & \left(\frac{0.5}{3}\right)^2
  \end{bmatrix} =
  \begin{bmatrix}
    3.06\cdot10^{10} & 0 \\
    0 & 2.78\cdot10^{-2}
  \end{bmatrix} \\
  W = \begin{bmatrix}
    \sigma_{\omega_R}^2 & 0 \\
    0 & \sigma_{v}^2
  \end{bmatrix} =
  \begin{bmatrix}
    \left(\frac{0.005 \omega_{R,rated}}{3}\right)^2 & 0 \\
    0 & \left(\frac{1}{3}\right)^2
  \end{bmatrix} =
  \begin{bmatrix}
    2.86\cdot10^{-6} & 0 \\
    0 & 1.11\cdot10^{-1}
  \end{bmatrix} \\
  \Pi=
  \begin{bmatrix}
    0.9850  &  0.0075  &  0.0075\\
    0.0075  &  0.9850  &  0.0075\\
    0.0075  &  0.0075  &  0.9850\\
  \end{bmatrix}
\end{gather}
In this application $\Pi$ is chosen to be a symmetric matrix, with $\pi_{ii}$ assigned and $\pi_{ik}$ computed by consequence as $\pi_{ik}=\pi_{ki}=\frac{1 - \pi_{ii}}{N_j} \,\forall \, i\neq k $ as proposed in \cite{kalman_based_IMM}.

Two tests are here proposed:
\begin{itemize}
  \item Constant WS of 8 $\si{\meter\per\second}$ and ramp air density  
  \item Randomly generated WS series with mean value between the cut in and the rated one, and ramp air density
\end{itemize}

\subsubsection{Constant WS} 
The first test is the application of the IMM with a constant input WS and imposing a linearly varying $\rho$. In particular, a WS of 8 $\si{\meter\per\second}$ has been imposed and the air density has been increased with a slope of $\frac{0.4}{450} \, \si{\kilo\gram\per\cubic\meter\per\second}$, starting at 50 s from the beginning of the simulation from an initial value of $0.9\rho$ and then saturated at $1.3\rho$. On top of this ramp, a random noise (with standard deviation $\sigma_{\rho}=\frac{0.05\rho}{3} \, \si{\kilo\gram\per\cubic\meter}$) has been added, simulating a possible fast variation. With this particular choice, $\rho$ spans a range that is partially covered by the models of the IMM and partially not, in order to study the algorithm behavior in both conditions. The results are reported in \autoref{fig:fig_IMM_sim_const_WS}.

\begin{figure}[!htbp]
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width=\columnwidth]{images/vectorial/2023_11_24_17_59_53omega_IMM_1.eps}
    \caption{Rotor rotational speed. \textit{Mod.} are the estimations done by the models run in parallel, \textit{Est. IMM} is the weighted average of the IMM, \textit{Sim. IMM} is the rotational speed obtained in the simulation with the IMM, \textit{Sim. fix gain} is the simulation with the constant gain.}
    \label{fig:fig_omega_IMM_1}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width=\columnwidth]{images/vectorial/2023_11_24_21_06_27probability_bar_IMM.png}
    \caption{Bar plot of the probability of the models. Each bar represents a probability up to 1, composed by the probability of each model.}
    \label{fig:fig_probability_IMM}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width=\columnwidth]{images/vectorial/2023_11_24_17_59_53rho_IMM.eps}
    \caption{\textit{Real} is the real $\rho$, \textit{Estimated} is the weighted sum of the model run in the IMM, and \textit{Filtered} is its filtered version. \textit{IMM models} are the density used in the model estimation.}
    \label{fig:fig_rho_IMM}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width=\columnwidth]{images/vectorial/2023_11_24_21_06_27K_opt_IMM.eps}
    \caption{Value of the gain $K_{opt}$ used in synthesis of the generator control reference. IMM are the values of the gains associated with the models run in the IMM.}
    \label{fig:fig_K_IMM}
  \end{subfigure}
  \caption{Comparison of the simulation run with the IMM and the constant gain, imposing the same input WS of 8 $\si{\meter\per\second}$, and introducing a ramp air density.}
  \label{fig:fig_IMM_sim_const_WS}
\end{figure}

As stated in the limitation of the analysis, the numerical values chosen for the density variation are broader than in reality and so the results are taken to the extreme. \\
\autoref{fig:fig_omega_IMM_1} reports the rotor rotational speed. It could be seen that the IMM approach stabilizes $\omega_R$ more than what is done by the fixed gain. The zoomed rectangle shows the comparison between the estimations of the models run in parallel in the algorithm, alongside their weighted sum, and the actual evolution of the system. \autoref{fig:fig_probability_IMM} is a bar plot of the probability of each model. Given 1 the sum of the probabilities of each model at the any time instant, each bar is colored proportional to the probability of the corresponding model. It could be seen how, going on with the simulation, the first model tends to be less probable while the other two increase their likelihood. \autoref{fig:fig_rho_IMM} shows how the filtered estimation follows the real air density. Furthermore, in the last part of the simulation where the real $\rho$ is no longer included within the range of the IMM models, the algorithm converges towards the most likely model. Finally, \autoref{fig:fig_K_IMM} shows for the control gain $\hat{K}_{opt,GE}$ a similar tendency as the air density.

\subsubsection{WS series}
Another test is run to compare the IMM-based control and the one based on the constant gain. Five WSs series with mean value between the cut-in and the rated one (4, 6, 8, 10, and 11 $\si{\meter\per\second}$) have been applied and for each of them a couple of simulations have been run. The same models and parameters variations as in the previous case have been applied. The comparison of the control methods have been made computing the integral of the powers in a reference time. The results are reported in \autoref{tab:comparison_IMM}, where the first colum is the integration time, the second is the WS of the tested case, the third, and fourth the mechanical energy extracted from the rotor with the two considered control techniques, while the fifth the normalized energy difference. The last three columns report the energy at the electrical output of the generator and the corresponding normalized energy difference, computed as:
\begin{equation}
  \Delta E_{norm} = \frac{E_{IMM}-E_{Const}}{E_{Const}}\cdot 100 \left[\%\right]
  \label{eq:energy_error}
\end{equation}
where $E_{IMM}$ is the energy computed with the simulation based on the IMM, and $E_{Const}$ is the one compute with the constant gain.

\begin{table}[!htbp]
  \caption{Produced energy in the considered time. $E_R$ and $E_{GE}$ are the mechanical extracted energy and the generator output. \textit{IMM} and \textit{Const.} states whether the control law uses the IMM algorithm or the constant $K_{opt,GE}$ gain respectively.}
  \centering
  \begin{tabular}{cc|ccc|ccc}
    \toprule
    % write R above the third and fourth column and GE above the last two
    Integration & & \multicolumn{3}{c|}{$E_R$} & \multicolumn{3}{c}{$E_{GE}$}\\
    time & WS & IMM & Const. & $\Delta E_{norm}$ & IMM & Const. & $\Delta E_{norm}$\\
    $\mesunt{\second}$ & $\mesunt{\meter\per\second}$ & $\mesunt{\giga\joule}$ &   $\mesunt{\giga\joule}$ & $\left[\%\right]$& $\mesunt{\giga\joule}$ &   $\mesunt{\giga\joule}$ & $\left[\%\right]$ \\
    \midrule
    \input{macro/2023_11_24_07_11_59energy.tex}
  \end{tabular}
  \label{tab:comparison_IMM}
\end{table}

From the numerical values of the error, it can be seen that the difference between the methods for the lowest WSs are small, even though the IMM seems to perform better. On the other hand at rated WS the IMM is less effective than the constant gain. This may be explained remembering that in this case the wind series may exceed the rated WS, and hence the pitching mechanism may enter in action reducing the power coefficient. When this happens, the model assumption on working at the maximum power coefficient is not valid anymore.

\autoref{fig:rho_comparison} reports the estimation of the air density in the different simulations, alongside with the real density and the ones used in the models. It can be seen that in general, all the simulations except the one with mean at the rated speed are able to track the real air density. Among the others, the higher WSs seems to track better the variations, probably because the imposed noises, which for simplicity has been set the same for all the simulations, affect more the lower speeds rather than the higher ones.
\begin{figure}[!htbp]
  \centering
  \includegraphics[width=0.65\columnwidth]{images/vectorial/2023_11_24_07_11_59rho_comparison.eps}
  \caption{Estimated air density in the simulations with the IMM control and WS, alongside the real density and the ones used in the models.}
  \label{fig:rho_comparison}
\end{figure}

\subsubsection{Conclusions on the IMM}
Overall the IMM behaves as expected in the tested cases, being able to track the changing in time of the air density, with constant and variable input WS at least when it is below the rated value. Even for what concerns the energy extraction, the results suggest that a control based on the IMM may be able to perform better than the one using a constant gain. Furthermore, as expected, whenever the real air density is not included in the models run in the IMM algorithm, then the output converges towards the most similar ones.\\
On the other hand, the high estimation error committed above rated WS shows a limitation of the proposed method, that depends on a choice done during the definition of the control, and so it was expected. In fact when the rated power is exceeded the pitching mechanism starts to act in order to control it, and so the assumption of working at the maximum $c_P$ done during the design phase is not valid anymore. A further development of the method may consider also the variability of the power coefficient and then being suitable for both the working regions of the WT, as for example done in \cite{kalman_based_IMM}.\\
Finally, it must be remembered that the tests reported here are not complete in terms of the numerical value assumed by the varying parameters, and so the real potential of the proposed control method has to be further validated with more realistic example cases. One of these may be having a $\rho$ varying with a more complex and realistic time law, both in amplitude and time interval in which these changes happen. This investigation may also reveal the WS measurement is not necessary, and only the rotational speed one is sufficient, as done by \cite{kalman_based_IMM}.

\newpage