\newpage
\section{Analysis of the dynamic behavior of the wind turbine}\label{sec:c_basic_model_simulation}
In this section the developed model is tested applying different controllers and different wind conditions such as:
\begin{itemize}
  \item slowly increasing wind ramp;
  \item random wind series;
  \item disabling of the pitch controller;
  \item random wind series and different pitching dynamics;
  \item comparison between the control laws based on the rotor power (as described in \autoref{subsec:torque_reference}) or the generator one (\autoref{subsec:method_control_P_GE}), for constant, ramp, or generated wind speeds.
\end{itemize}
\subsection{Simulation with velocity ramp}
\subsubsection[Simulation setting]{Simulation setting for test with velocity ramp}
The model is tested providing as wind input a ramp starting at time 0 $\left[\si{\second}\right]$. The parameters that may be changed in the simulation: starting and finishing wind speeds, time length of the ramp.\\
It is decided to test 3 wind velocity conditions to investigate the three main operating regions. \autoref{tab:simulation_config} reports the configurations of these simulations. 
\begin{table}[htb]
    \caption{Configuration parameters for the simulation}
    \centering
    \begin{tabular}{lcccc}
    \toprule
      Simulation & Regime  & WS & Ramp length \\ 
       & & $\left[\si{\meter\per\second}\right]$ & $\left[\si{\second}\right]$ \\ \midrule       
       I & Below & 4-10 & 2000  \\
       II & Below $\rightarrow$ above rated & 10-14 & 2000 \\
       III & Above & 14-20 & 2000  \\
       \bottomrule
    \end{tabular}
    \label{tab:simulation_config}
\end{table}

A post-process check can be done on the powers, in particular that the one provided by the wind is equal to the sum of the one processed by the generator, the rate of variation of the kinetic energy in the inertia and the one lost in damping. In particular the power equations on the rotor side of the transmission can be written starting from \autoref{eq:mech_eq}:
\begin{gather}
    J_{eq}\dot{\omega_{R}} = T_R^R - T_R^G-B_{eq}\omega_R\\
    J_{eq}\dot{\omega_{R}} + T_R^G + B_{eq}\omega^R = T_R^R\\
    \left(J_{eq}\dot{\omega_{R}} + T_R^G + B_{eq}\omega^R\right)\omega^R = \left(T_R^R\right)\omega^R\\
    J_{eq}\dot{\omega_{R}}\omega_{R} + T_R^{G}\omega_{R} + B_{eq}\omega^{R^{2}} = T_R^{R}\omega_{R}\\
    P_{inertia} + P_{generator} + P_{damping} = P_{rotor} 
    \label{eq:power_balance}
\end{gather}

\subsubsection[Simulation results]{Simulation results for test with velocity ramp}
The results of the simulations are reported in \autoref{fig:simulation_1}, \ref{fig:simulation_2}, \ref{fig:simulation_3}. \\
In particular:
\begin{itemize}
  \item \autoref{fig:wind_sim_I}, \ref{fig:wind_sim_II}, \ref{fig:wind_sim_III} report the wind velocity as function of the simulation time;
  \item \autoref{fig:omega_sim_I}, \ref{fig:omega_sim_II}, \ref{fig:omega_sim_III} are the parametrizations of the rotor rotational speed as function of the wind speed;
  \item \autoref{fig:omega_full_fedback} is the parametrization of the rotational speed using also the damping term in the feedback line; 
  \item \autoref{fig:power_sim_I}, \ref{fig:power_sim_II}, \ref{fig:power_sim_III} are the parametrizations of the power as function of the wind speed;
  \item \autoref{fig:pitch_sim_I}, \ref{fig:pitch_sim_II}, \ref{fig:pitch_sim_III} are the parametrizations of the pitch angle as function of the wind speed;
  \item \autoref{fig:power_check_sim_I}, \ref{fig:power_check_sim_II}, \ref{fig:power_check_sim_III} are the power check, as described in \autoref{eq:power_balance};
  \item \autoref{fig:torque_sim_I} is the generator torque reference as function of the rotor rotational speed.
\end{itemize}

% plots of the results
\input{c_basic_model_results}

It could be seen that below rated wind speed (in the case of control signal using only the $K_{opt}$, \autoref{fig:omega_sim_I}) there is a deviation between the rotor speed in static conditions and the one obtained in the simulation. The main source of this mismatch is the exclusion of the damping term because the same error is much more reduced when the additional term is considered (as in \autoref{fig:omega_full_fedback}). The additional difference is due to the inertial terms. 

\subsection{Simulation with generated wind time series}\label{sec:wind_series_sim}
\subsubsection[Simulation settings]{Simulation settings for test with wind time series}
The model is tested with an input wind time series three times, the first with mean \acrshort{WS} of 6 $\mesunt{\meter\per\second}$, the second with 11.5 $\mesunt{\meter\per\second}$, and the third with 20 $\mesunt{\meter\per\second}$. These values are chosen to test the simulator in the three characteristics wind regimes. In the first simulation the turbulence is chosen to be $\sigma=0.6 \mesunt{\meter\per\second}$ while for the other $\sigma=1 \mesunt{\meter\per\second}$. The simulation is run for $t=150\ \mesunt{\second}$ and the results of the last 100 $\mesunt{\second}$ are plotted in order to get rid of the transient behavior. The sampling frequency for the wind series generation is set to be $f_s=50 \left[\si{\hertz}\right]$.

\subsubsection[Simulation results]{Simulation results for test with wind time series}
The results of this simulation are reported in \autoref{fig:simulation_rand_wind_NPC}, where the wind time series and the parametrizations of some quantities as function of the instantaneous wind speed are reported on top of the corresponding reference lines obtained by static analysis. Futhermore, the \acrfull{RMS} error between the value of some observed quantities and their static values will be presented in \autoref{tab:RMS_comparison}, where they will be also compared with the results of another similar simulation. \\
What can be seen from the results is that the observed quantities are clustered around the static curve. This is reasonable since if the turbulence would have been set to 0 then the expected results would have been a point on the static curve corresponding to the investigated WS. It must be highlighted that in these curves the initial transient part has been eliminated in order to have a better visualization. 

\begin{figure}[htb]
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_14_56_44fig_wind_TS.eps}
    \caption{Wind time series}
    \label{fig:2023_05_1_00_55_48fig_wind_TS.eps}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_14_57_26fig_pitch_param.eps}
    \caption{Pitch angle time series}
    \label{fig:2023_05_1_00_50_19fig_power_param}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_14_56_58fig_power_param.eps}
    \caption{Input power to the generator}
    \label{fig:2023_05_1_00_51_17fig_omega_param}
  \end{subfigure}
  \begin{subfigure}{0.49\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_14_57_38fig_omega_param.eps}
    \caption{Rotational speed}
    \label{fig:2023_05_1_00_50_58fig_pitch_param}
  \end{subfigure}
  \caption{Results of simulation with a generated wind series}
  \label{fig:simulation_rand_wind_NPC}
\end{figure}

\subsection{Test disabling the pitch angle gain scheduling}\label{subsec:gain_scheduling_disabling}
In order to verify the effect of the gain scheduling with respect a fixed gain for the pitch angle controller, three simulations with different wind speeds are proposed, $V_{10} = 11.5, 15, 20 \ \mesunt{\meter\per\second}$. For each of them four different gains are used. The settings for all of them are reported in \autoref{tab:simulation_config_variable_gains}, \autoref{tab:simulation_config_variable_gains2}, and \autoref{tab:simulation_config_variable_gains3}. \\
In particular, the first and the fourth simulations use the gain scheduling paradigm while the other two have a fixed gains. The specific numerical value chosen in the constant case are representative of two very different regions of the scheduling case since \textit{simulation 2} has values close to the ones used at low wind speeds, while \textit{3} has value close to the high wind speeds. 

\subsubsection[$V_{10}=11.5 \, \mesunt{\meter\per\second}$]{Test disabling the pitch angle gain scheduling and WS of V\textsubscript{10}= 11.5 $\left[ \text{ms}\textsuperscript{-1} \right]$}
The first of the three simulations is run at $V_{10} = 11.5 \ \mesunt{\meter\per\second}$. Here an intermitting activation of the pitching mechanism is expected since the wind speed fluctuates around its nominal value.\\
\autoref{tab:simulation_config_variable_gains} reports the simulation settings while \autoref{fig:gain_scheduling_time_dependency} reports the time evolution of the pitch angle, rotor rotational speed, and the generator torque obtained from the simulations. 

\begin{table}[htb]
  \caption{Configuration parameters for the simulation in \autoref{fig:gain_scheduling_time_dependency}}
  \centering
  \begin{tabular}{ccccc}
  \toprule
    Simulation & $V_{10}$  & $\sigma_{V_{10}}$ & Gains schedule \\ 
     & $\left[\si{\meter\per\second}\right]$ & $\left[\si{\meter\per\second}\right]$ & \\ \midrule       
     1 & 11.5 & 1 & As in \autoref{subsec:gain_schdeuling_DTU10MW}  \\
     2 & 11.5 & 1 & $k_p = 2 \ \mesunt{\second}$, $k_i=0.9 \ [-]$ \\
     3 & 11.5 & 1 & $k_p = 0.25 \ \mesunt{\second}$, $k_i=0.2 \ [-]$  \\
     4 & 11.5 & 1 & As reported in \cite{Olimpo_Anaya‚ÄêLara}  \\
     \bottomrule
  \end{tabular}
  \label{tab:simulation_config_variable_gains}
\end{table}

\begin{figure}[htb]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_18_59_44fig_wind_TS.eps}
    \label{fig:fig_wind_15ms}
    \caption{Wind time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_18_59_51fig_pitch_dynamic.eps}
    \label{}
    \caption{Pitch angle time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_18_59_58fig_omega_dynamic.eps}
    \label{}
    \caption{Rotor rotational speed time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_19_00_14fig_torque_dynamic.eps}
    \label{}
    \caption{Torque time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_19_00_04fig_power_dynamic.eps}
    \label{}
    \caption{Power time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_19_00_27fig_generator_power_check.eps}
    \label{}
    \caption{Generator power time series}
  \end{subfigure}
  \caption{Comparison of the simulation with generated time series and three different gain scheduling strategies}
  \label{fig:gain_scheduling_time_dependency}
\end{figure}
After the simulation and in order to evaluate it quantitatively, the RMS error between the steady state quantities (i.e. the last 40 seconds of the simulation) and the corresponding expected nominal values above rated wind speed are computed, and reported in \autoref{tab:res_variable_gains}.\\

In this simulation these error metrics are not so representative since the wind is not always above the rated one and therefore the corresponding power, torque and rotational speed are not always expected to be reached. They are reported anyway in order to be then compared with the simulations proposed later on.  

\begin{table}[htb]
  \caption{RMS error of the results obtained with setting in \autoref{fig:gain_scheduling_time_dependency}}
  \centering
  \begin{tabular}{cccccccc}
    \toprule
      Simulation & \multicolumn{2}{c}{$\omega_R$} & \multicolumn{2}{c}{$P_G$} & \multicolumn{2}{c}{$T_G$} \\ 
       & $\left[\si{\radian\per\second}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\watt}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\newton\meter} \right]$ & $ \% \left[-\right]$ \\ \midrule       
       1 &  0.03 &  3.07 &  0.53  &  5.25  &  0.31  &  3.12 \\
       2 &  0.03 &  2.93 &  0.54  &  5.30  &  0.30  &  3.01 \\
       3 &  0.04 &  4.36 &  0.80  &  7.92  &  0.49  &  4.88 \\
       4 &  0.04 &  3.56 &  0.63  &  6.24  &  0.38  &  3.79 \\
     \bottomrule
  \end{tabular}
  \label{tab:res_variable_gains}
\end{table}

The first two simulations are very close to each other, since the static gain of \textit{sim. 2} is almost the same of the scheduling at rated speed. Furthermore, the results of the fourth simulation are not too different from the first two. Finally, it could be also noticed that the gain in case \textit{3} is very different from the other one, suggesting that this choice is not suitable for this condition. 

\subsubsection[$V_{10}=15 \, \mesunt{\meter\per\second}$]{Test disabling the pitch angle gain scheduling and WS of V\textsubscript{10}= 15 $\left[ \text{ms}\textsuperscript{-1} \right]$}
The second simulation is run with $V_{10}=15 \ \mesunt{\meter\per\second}$, and so the wind speed is expected to be always above the rated one. The simulation settings are reported in \autoref{tab:simulation_config_variable_gains2}.
\begin{table}[htb]
  \caption{Configuration parameters for the simulation in \autoref{fig:gain_scheduling_time_dependency2}}
  \centering
  \begin{tabular}{ccccc}
  \toprule
    Simulation & $V_{10}$  & $\sigma_{V_{10}}$ & Gains schedule \\ 
     & $\left[\si{\meter\per\second}\right]$ & $\left[\si{\meter\per\second}\right]$ & \\ \midrule       
     1 & 15 & 1 & As in \autoref{subsec:gain_schdeuling_DTU10MW}  \\
     2 & 15 & 1 & $k_p = 2 \ \mesunt{\second}$, $k_i=0.9 \ [-]$ \\
     3 & 15 & 1 & $k_p = 0.25 \ \mesunt{\second}$, $k_i=0.2 \ [-]$  \\
     4 & 15 & 1 & As reported in \cite{Olimpo_Anaya‚ÄêLara}  \\
     \bottomrule
  \end{tabular}
  \label{tab:simulation_config_variable_gains2}
\end{table}

\autoref{fig:gain_scheduling_time_dependency2} reports the time evolution of the pitch angle, rotor rotational speed, and the generator torque. 

\begin{figure}[htb]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_06fig_wind_TS.eps}
    \label{fig:2023_05_9_20_55_30fig_wind_TS}
    \caption{Wind time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_17fig_pitch_dynamic.eps}
    \label{fig:2023_05_9_20_55_30fig_pitch_dynamic}
    \caption{Pitch angle time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_26fig_omega_dynamic.eps}
    \label{fig:2023_05_9_20_55_46fig_omega_dynamic}
    \caption{Pitch angle time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_43fig_torque_dynamic.eps}
    \label{fig:2023_05_9_20_56_15fig_torque_dynamic}
    \caption{Torque time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_11_34fig_power_dynamic.eps}
    \label{fig:2023_05_9_20_55_59fig_power_dynamic}
    \caption{Power time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_12_07fig_generator_power_check.eps}
    \label{fig:2023_05_20_15_07_04fig_generator_power_check}
    \caption{Generator power time series}
  \end{subfigure}
  \caption{Comparison of the simulation with generated time series and three different gain scheduling strategies}
  \label{fig:gain_scheduling_time_dependency2}
\end{figure}

The \acrshort{RMS} error between the steady state value and the corresponding expected static is evaluated. The results are reported in the \autoref{tab:res_variable_gains2}.
\begin{table}[htb]
  \caption{RMS error of the results obtained with setting in \autoref{fig:gain_scheduling_time_dependency2}}
  \centering
  \begin{tabular}{cccccccc}
    \toprule
      Simulation & \multicolumn{2}{c}{$\omega_R$} & \multicolumn{2}{c}{$P_G$} & \multicolumn{2}{c}{$T_G$} \\ 
       & $\left[\si{\radian\per\second}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\watt}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\newton\meter} \right]$ & $ \% \left[-\right]$ \\ \midrule      
     1 & 0.01 &  1.23 &  0.08  &  0.75  &  0.10  &  1.00 \\
     2 & 0.01 &  0.87 &  0.02  &  0.22  &  0.08  &  0.79 \\
     3 & 0.02 &  2.18 &  0.23  &  2.27  &  0.17  &  1.66 \\
     4 & 0.02 &  1.78 &  0.16  &  1.56  &  0.13  &  1.29 \\
    
     \bottomrule
  \end{tabular}
  \label{tab:res_variable_gains2}
\end{table}

As could be seen from the root mean square errors, the gain scheduling simulations performs better than the fixed one. In fact, even tough \textit{simulation 2} has lowest error value, the ones of \textit{3} are almost double than the \textit{1}. This means that a fixed gain may perform well in a certain wind region (i.e. the one corresponding at the same gain in the scheduling approach) but probably it will underperform in another different from that one.  

\subsubsection[$V_{10}=20 \, \mesunt{\meter\per\second}$]{Test disabling the pitch angle gain scheduling and WS of V\textsubscript{10}= 20 $\left[ \text{ms}\textsuperscript{-1} \right]$}
The last tested \acrshort{WS} is 20 $\mesunt{\meter\per\second}$. The simulation parameters are reported in \autoref{tab:simulation_config_variable_gains3} while the results in \autoref{fig:gain_scheduling_time_dependency3} and \autoref{tab:res_variable_gains3}.

\begin{table}[htb]
  \caption{Configuration parameters for the simulation in \autoref{fig:gain_scheduling_time_dependency3}}
  \centering
  \begin{tabular}{ccccc}
  \toprule
    Simulation & $V_{10}$  & $\sigma_{V_{10}}$ & Gains schedule \\ 
     & $\left[\si{\meter\per\second}\right]$ & $\left[\si{\meter\per\second}\right]$ & \\ \midrule       
     1 & 20 & 2.0 & As in \autoref{subsec:gain_schdeuling_DTU10MW}  \\
     2 & 20 & 2.0 & $k_p = 2 \ \mesunt{\second}$, $k_i=0.9 \ [-]$ \\
     3 & 20 & 2.0 & $k_p = 0.25 \ \mesunt{\second}$, $k_i=0.2 \ [-]$  \\
     4 & 20 & 2.0 & As reported in \cite{Olimpo_Anaya‚ÄêLara}  \\
     \bottomrule
  \end{tabular}
  \label{tab:simulation_config_variable_gains3}
\end{table}

\begin{figure}[htb]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_17fig_wind_TS.eps}
    \label{}
    \caption{Wind time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_27fig_pitch_dynamic.eps}
    \label{}
    \caption{Pitch angle time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_38fig_omega_dynamic.eps}
    \label{}
    \caption{Pitch angle time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_55fig_torque_dynamic.eps}
    \label{}
    \caption{Torque time series}
  \end{subfigure}
  \vskip\baselineskip
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_20_46fig_power_dynamic.eps}
    \label{}
    \caption{Power time series}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_3_20_21_12fig_generator_power_check.eps}
    \label{}
    \caption{Generator power time series}
  \end{subfigure}
  \caption{Comparison of the simulation with generated time series and three different gain scheduling strategies}
  \label{fig:gain_scheduling_time_dependency3}
\end{figure}

\begin{table}[htb]
  \caption{RMS error of the results obtained with setting in \autoref{fig:gain_scheduling_time_dependency3}}
  \centering
  \begin{tabular}{cccccccc}
    \toprule
      Simulation & \multicolumn{2}{c}{$\omega_R$} & \multicolumn{2}{c}{$P_G$} & \multicolumn{2}{c}{$T_G$} \\ 
       & $\left[\si{\radian\per\second}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\watt}\right]$ & $ \% \left[-\right]$ & $\left[\si{\mega\newton\meter} \right]$ & $ \% \left[-\right]$ \\ \midrule        
     1 & 0.01 &  1.17 &  0.07  &  0.66  &  0.10  &  0.96  \\
     2 & 0.01 &  0.91 &  0.03  &  0.29  &  0.08  &  0.81  \\
     3 & 0.02 &  1.80 &  0.19  &  1.84  &  0.14  &  1.42  \\
     4 & 0.02 &  1.69 &  0.16  &  1.61  &  0.13  &  1.28 \\ 
    
     \bottomrule
  \end{tabular}
  \label{tab:res_variable_gains3}
\end{table}

The considerations that can be done on this case are similar to the previous ones. 

\subsubsection[Parametrization with respect to the wind speed]{Test disabling the gain scheduling and plotting the results parametrized for the WS}\label{subsec:gain_disabled}
Another comparison between the use or not of the gain scheduling may be done repeating the simulations done in \autoref{sec:wind_series_sim} (random WS) but disabling the blade gain scheduling, and letting the gains of the previous \textit{simulation 2} (i.e. $k_p = 2 \ \mesunt{\second}$, $k_i=0.9 \ [-]$). The corresponding results are reported in \autoref{fig:simulation_rand_wind_no_gain_scheduling}.
\begin{figure}[htb]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_15_24_55fig_wind_TS.eps}
    \caption{Wind time series}
    \label{fig:2023_05_8_22_43_35fig_wind_TS.eps}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_15_25_29fig_pitch_param.eps}
    \caption{Pitch angle time series}
    \label{fig:2023_05_8_22_44_05fig_pitch_param}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_15_25_02fig_power_param.eps}
    \caption{Input power to the generator}
    \label{fig:2023_05_8_22_44_15fig_power_param}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_4_15_25_43fig_omega_param.eps}
    \caption{Rotational speed}
    \label{fig:2023_05_8_23_17_57fig_omega_param}
  \end{subfigure}
  \caption{Results of simulation with a generated wind series, no blade gain scheduling}
  \label{fig:simulation_rand_wind_no_gain_scheduling}
\end{figure}

\begin{table}[htb]
  \centering
  \caption{RMS errors of the simulations done in \autoref{sec:wind_series_sim} and \autoref{subsec:gain_disabled} alongside their normalized values}
  \label{tab:RMS_comparison}
  \begin{tabular}{cccccccccc}
    \toprule
      $V_0$  & Sim. & $\omega_R$ & $\omega_{R,norm}$ & $P_{G}$ & $P_{G,norm}$ & $T_{G}$ & $T_{G,norm}$ & $\theta$ & $\theta_{norm}$ \\ 
      $\mesunt{\meter\per\second}$ & & $\mesunt{\radian\per\second}$ & $\left[\%\right]$ & $\mesunt{\mega\watt}$ & $\left[\%\right]$ & $\mesunt{\mega\newton\per\meter}$ & $\left[\%\right]$ & $\mesunt{\radian}$ & $\left[\%\right]$ \\ \hline
      \multirow{2}{*}{6.0}  & \ref{sec:wind_series_sim} &  0.04 &  7.27 & 0.36 & 23.66 & 0.45 & 15.73 & 0.00 &  0.00 \\
      & \ref{subsec:gain_disabled} &  0.04 &  7.27 & 0.36 & 23.66 & 0.45 & 15.73 & 0.00 &  0.00 \\   \hline
      \multirow{2}{*}{11.5} & \ref{sec:wind_series_sim} & 0.04 &  3.83 & 0.93 &  9.19 & 0.67 & 6.66 & 0.05 & 148.81 \\
      & \ref{subsec:gain_disabled} & 0.04 &  3.68 & 0.93 &  9.16 & 0.66 &  6.62 & 0.04 & 144.00 \\ \hline 
      \multirow{2}{*}{20.0} & \ref{sec:wind_series_sim} & 0.02 &  1.49 &  0.08 & 0.79 &  0.12 & 1.24 & 0.01 & 4.86 \\
      & \ref{subsec:gain_disabled} & 0.02 &  1.52 & 0.16 &  1.56 & 0.15 &  1.54 & 0.02 &  7.80 \\ \bottomrule
  \end{tabular}
\end{table}

Even though the results of the normalized errors have been reported for completeness in \autoref{tab:RMS_comparison}, their value is not always meaningful, since the normalization has been done for the value of the quantity of interest at the mean wind velocity, while the quantity itself evolves in time during the simulation. This could be well seen in the pitch error, where the high value is due to the fact that the normalization factor is a value close to 0 $\mesunt{\degree}$ while the pitch changes around this value.

\subsubsection[Conclusions]{Conclusions on the tests without the gain scheduling for the pitching}
The results obtained in \autoref{subsec:gain_scheduling_disabling} show that the choice of the gain influences the performance of the system. In particular the gain used in the \textit{sim. 3} seems to be always the worst choice in the tested cases. Between the scheduling rule, the one proposed in \autoref{subsec:gain_schdeuling_DTU10MW} seems to perform better than the one of \cite{Olimpo_Anaya‚ÄêLara}. Finally, it seems that the constant gain used in \textit{sim. 2} is always the best choice, probably because it is the highest one and so produces the response with the highest effort.

% \subsection{Disabling of the pitch angle controller}
% In order to show the effectiveness of the blade pitch controller one can disable it at all and let the turbine work at fixed pitch angle as happened for the purely stall regulated ones (see \autoref{subsec:stall_regulation_theory}). While in the old-styled stall regulated turbines the controller ensured the fixed rotor speed for letting the asynchronous machine to work at the desired velocity, here the controller's aim is to limit the generator power.\\
% In the simulations, the disabling is performed setting $k_p=0 \ \mesunt{\second}$ and $k_i=0 \ [-]$. \textcolor{red}{WRITE IT BETTER, SUMMARIZING WHAT IT IS WRITTEN IN THE THEORETICAL PART - It is expected that increasing the wind speed above the rated one, the rotor rotational speeds increase (and consequently the extracted power), up to the drag becomes so high to let the rotor speed to decrease on its own. }\\

% This test case is run for a total of 600 $\mesunt{\second}$ with a wind ramp from 6 up to 15 $\mesunt{\meter\per\second}$ in 400 $\mesunt{\second}$, and then the final velocity kept constant. Some of the results are reported in \autoref{fig:simulation_rand_wind_no_pitch_control}, where they are compared with the case of blade pitch scheduling, for better understanding the differences. In particular the \textit{sim. 1} uses the scheduling of \autoref{subsec:gain_schdeuling_DTU10MW} while the \textit{sim. 2} is the one with disabled gain.\\
% More in detail, clearly \autoref{fig:pitch_dynamic_no_ctrl} shows that in \textit{sim. 2} the pitch is not changed, while the other does so after the reaching of the rated wind speed. \autoref{fig:omega_dynamic_no_ctrl} shows that the rotational speed is the same below the rated velocity, because both of the configuration pursue the MPPT, while they are different above, with \textit{sim. 1} limited at the rated value, while still continues to grow \textit{sim. 2} up to the end of the wind ramp. In this letter case the different slope is due to the decreasing of the torque (visible in \autoref{fig:torque_dynamic_no_ctrl}), necessary to keep the required constant power. \\
% \autoref{fig:power_dynamic_no_ctrl} shows that the power extracted from the wind is much higher in the second simulation than in the first one while the mechanical power at the generator is the same. \autoref{fig:power_check_1} and \ref{fig:power_check_2} shows how the incoming rotor power is transformed in the different contributions introduced in \autoref{eq:power_balance}. In particular, in both of the simulations the energy stored in the rotor inertia is null when the regime speed is reached, while the difference between the incoming power and the mechanical provided as input at the generator is equal to the one dissipated by the damping.

% \begin{figure}[htb]
%   \begin{subfigure}{0.5\columnwidth}
%     \centering
%     \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_10_38_45fig_pitch_dynamic.eps}
%     \caption{Pitch angle time series}
%     \label{fig:pitch_dynamic_no_ctrl}
%   \end{subfigure}
%   \begin{subfigure}{0.5\columnwidth}
%     \centering
%     \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_10_38_56fig_omega_dynamic.eps}
%     \caption{Rotor rotational speed time series}
%     \label{fig:omega_dynamic_no_ctrl}
%   \end{subfigure}
%   \begin{subfigure}{0.5\columnwidth}
%     \centering
%     \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_10_39_06fig_power_dynamic.eps}
%     \caption{Rotor power and generator input power}
%     \label{fig:power_dynamic_no_ctrl}
%   \end{subfigure}
%   \begin{subfigure}{0.5\columnwidth}
%     \centering
%     \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_10_39_17fig_torque_dynamic.eps}
%     \caption{Rotational speed}
%     \label{fig:torque_dynamic_no_ctrl}
%   \end{subfigure}
%   \begin{subfigure}{0.5\columnwidth}
%     \centering
%     \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_10_20_02power_check1.eps}
%     \caption{Comparison of the powers of \textit{sim.1}}
%     \label{fig:power_check_1}
%   \end{subfigure}
%   \begin{subfigure}{0.5\columnwidth}
%     \centering
%     \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_10_20_02power_check2.eps}
%     \caption{Comparison of the powers of \textit{sim.2}}
%     \label{fig:power_check_2}
%   \end{subfigure}

%   \caption{Results of simulation with a ramp wind series, disabling blade pitch control}
%   \label{fig:simulation_rand_wind_no_pitch_control}
% \end{figure}

\subsection{Test changing the pitching actuator dynamic}\label{subsec:changing_pitch_actuator}  
In this section the dynamic of the pitching mechanism is changed in order to see the different reactivity in the reduction of the power extracted form the wind. It is expected that making the dynamic faster allows to follow the wind fluctuations better at the price of a higher effort, while a slower dynamic will introduce some delay in the control between the incoming speed and the corresponding blade actuation.\\
To validate this hypothesis, three simulations are run with different transfer functions modelling the blade actuator. All of them are run with the usual wind speed of $V_{10}=15\ \mesunt{\meter\per\second}$ and $\sigma_{V_{10}}=1 \ \mesunt{\meter\per\second}$. \\
The employed transfer functions are reported in \autoref{tab:tf_blade_mechanism}:
\begin{table}[htb]
  \caption{Transfer functions modelling the blade actuator}
  \centering
  \begin{tabular}{cc}
  \toprule
    Simulation & G=$\frac{\theta}{\hat{\theta} }$\\\midrule
    1 & $\frac{(2\pi)^2}{s^2+2 \cdot 0.7 \cdot 2\pi+(2\pi)^2}$\\
    2 & $\frac{(2\pi)^2}{s^2+2 \cdot 0.7 \cdot 5\cdot2\pi+(5\cdot2\pi)^2}$\\
    3 & $\frac{(\frac{2\pi}{5})^2}{s^2+2\cdot 0.7 \cdot\frac{2\pi}{5}+(\frac{2\pi}{5})^2}$ \\
    \bottomrule
  \end{tabular}
  \label{tab:tf_blade_mechanism}
\end{table}

It must be noted that Simulation 1 is what suggested in \cite{Olimpo_Anaya‚ÄêLara}, while 2 has a faster dynamic and 3 a slower rather than 1.

\begin{figure}[htb]
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_21_45_29fig_wind_TS.eps}
    \caption{Wind speed time series}
    \label{}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_21_45_38fig_pitch_dynamic.eps}
    \caption{Dynamic of the pitch angle}
    \label{}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_21_45_44fig_omega_dynamic.eps}
    \caption{Rotational speed}
    \label{}
  \end{subfigure}
  \begin{subfigure}{0.5\columnwidth}
    \centering
    \includegraphics[width = \columnwidth]{images/vectorial/2023_10_5_21_45_51fig_power_dynamic.eps}
    \caption{Power extracted from wind and mech. power at the generator}
    \label{}
  \end{subfigure}
  \caption{Results of simulation with a generated wind series, different blade actuation mechanisms}
  \label{fig:simulation_with_different_pitch_dynamic}
\end{figure}
The results of the simulations are reported in \autoref{fig:simulation_with_different_pitch_dynamic} and they show how the first two mechanisms are pretty similar, meaning that the transfer function suggested by \cite{Olimpo_Anaya‚ÄêLara} and employed in all the other simulation so far does not introduce a great delay in the response of the blade actuation. On the other hand, the third transfer function is slower, meaning that the blades follow the wind change with some delay and for this reason they are rotated by of larger amount.

\subsection[Below rated WS]{Simulation with the generator's torque reference based on the generator output} \label{subsec:validation_control_P_GE}
In this section the control law for the generators's torque based on the generator output power developed in \autoref{subsec:method_control_P_GE} is tested and compared with the one based on the rotor power and developed in \autoref{subsec:torque_reference}.
% For this simulation, in order to avoid the interference of the controller not allowing the generator to reach the steady state, this component has been removed and the torque reference value has been directly used into the dynamic equation of the rotor power.
\subsubsection{Simulation with the generator's torque reference based on the generator output for constant WS below rated}
The generator torque's control law based on the generator has been compared with the one of the rotor, for WS between the cut in and the rated one. A critical condition for this tests is that the rotor rotational speed reaches exactly the ones producing the desired tip speed ratio. For this reason, initially the damping reducing the power sent by the rotor to the input of the generator is removed (i.e. $B_{eq}=0 \mesunt{\kilo\gram\square\meter\per\second}$). \\
In the simulation, 5 constant wind speeds has been provided and the corresponding steady state values of mechanical input and electrical output powers to the generator have been evaluated. The results are reported in \autoref{fig:comparison_control_laws_no_B}.
\begin{figure}[htb]
  \centering
  \begin{subfigure}{\columnwidth}
    \includegraphics[width = \columnwidth]{images/vectorial/2023_11_12_17_17_05comparison_control_laws.eps}
    \caption{Simulation without damping}
    \label{fig:comparison_control_laws_no_B}
  \end{subfigure}
  \begin{subfigure}{\columnwidth}
    \includegraphics[width = \columnwidth]{images/vectorial/2023_11_12_17_33_32comparison_control_laws.eps}
    \caption{Simulation with damping}
    \label{fig:comparison_control_laws_B}
  \end{subfigure}
  \caption{Comparison of input power at the rotor and output power of the generator for the control laws based on the maximization of the power extracted from the resource (called \textit{Rotor} in the legend) and the maximization of the power generated electrical power (called \textit{Generator} in the legend).}
  \label{fig:comparison_control_laws}
\end{figure}

It could be seen that without damping the control law based on the maximization of the power at the rotor side (called \textit{rotor} in the legend) is always able to provide more mechanical input power, while the one based on the generator electrical output power (called \textit{generator} in the legend) is able to deliver more electrical power for all the velocities except 4 $\mesunt{\meter\per\second}$, where still the difference is small.  \\
As could be seen in \autoref{fig:comparison_control_laws_B}, when the damping is included into the picture the $P_R$ based on the rotor is higher than the other for all the velocities while the corresponding $P_{GE}$ is always lower except for the rated wind speed.\\
As expected the control based on the generator is less valid for high and low WS, where the assumption of constant parameters is less valid rather than using the velocity-dependent parameters. 

\subsubsection{Simulation with the generator's torque reference based on the generator output for generated wind series}
The implemented control law is also tested for a generic wind series input. The chosen 5 means are 5, 6, 8, 10, 11.4 $\mesunt{\meter\per\second}$ and the turbulence 0.5, 0.5, 1, 1, 1 $\mesunt{\meter\per\second}$. For each wind condition, the simulation is run twice, initially employing a control low based on the generator while later on the rotor. All the simulation lasted 500 $\mesunt{\second}$. The comparison of the results is done calculating the energy extracted by integrating the corresponding power, which depends both on the power and the time chosen for the integration. To get rid of the dependency introduced by the arbitrary choice of the integrations length and have more fair results, the energy is evaluated for 4 time intervals form the end of the simulation. The results are reported in \autoref{tab:energy_K_opt_comp}. The normalized energy difference is given by:
\begin{equation}
  \Delta E = \frac{E_{generator} - E_{rotor}}{E_{generator}}\cdot 100 \, \left[\%\right]
\end{equation}

\begin{table}[htb]
  \centering
  \caption{Produced energy, given by the integration of the power over $\Delta t$ time from the end of the simulation. $E_R$ is the energy extracted form the wind, $E_G$ is the one produced by the generator, and $\Delta E$ is the normalized difference between the two energies. \textit{Gen.} and \textit{Rot.} stands for the control law based on the generator and the rotor respectively.}
  \begin{tabular}{cc|ccc|ccc}
    \toprule
    & & \multicolumn{3}{c}{$E_R$} & \multicolumn{3}{|c}{$E_G$} \\
     $\Delta t \,\mesunt{\second}$ &  $V_{10} \mesunt{\meter\per\second}$ & Gen. $\mesunt{\giga\joule}$ & Rot. $\mesunt{\giga\joule}$ & $\Delta E \, \left[\%\right]$ & Gen. $\mesunt{\giga\joule}$ & Rot. $\mesunt{\giga\joule}$ & $\Delta E \, \left[\%\right]$ \\ \midrule
    \input{macro/energy_K_opt_comp.tex}
  \end{tabular}
  \label{tab:energy_K_opt_comp}
\end{table}

From the results it is well visible what was already described, meaning that the control law based on the generator is more effective than the other for WSs far from the rated ones. \\
As final remark it must be remembered that with this type of input WS it is possible that $V_{0,rated}$ may be exceeded in the case of the highest tested speeds, and so also the pitching may have an influence on the results. The explicit impact of this further controller has not be evaluated because it is difficult to find a representative test case to do so and furthermore because it is not so important. In fact one is interested in the overall performance of the turbine (i.e. how much energy is produced) without separating the contribution of the different components. 

\subsection{Comparison of the electrical power output in the case of different gains in the power controller}\label{subsec:c_different_KoptGE}
\textcolor{red}{Questa parte era stata messa nel capitolo 9, ma ha pi√π senso anticiparlo qui.}
Before going on with further analysis it may be interesting to quantify how does the turbine's performance changes if using a gain different than the one identified as optimal. In particular, 7 gains factors $\beta$ around the optimal one are identified 0.5, 0.8, 0.9, 1.0, 1.1, 1.2, and 1.5. Then a ramp WS profile between 4 and 12 $\mesunt{\meter\per\second}$ lasting 1000 $\mesunt{\second}$ has been applied. The comparison of the results is done again by means of the energy extracted, and again different integration times has been chosen to get rid of their arbitrary choice. The numerical results are reported in \autoref{tab:error_KoptGE}. 

\begin{table}[htb]
  \caption{Extracted energy by rescaling the value of the $K_{opt,GE}$ gain by $\beta$. $E_R$ and $E_G$ are the energy extracted from the wind and produced by the generator respectively, while $\Delta E_R$ and $\Delta E_G$ are the difference between the energy produced using $\beta K_{opt,GE}$ and the $K_{opt,GE}$}
  \centering
  \begin{tabular}{ccccccc}
  \toprule
  Int. time $\mesunt{\second}$ & Sim. & $\beta$ gain & $E_R \, \mesunt{\giga\joule}$ & $\Delta E_R \left[\%\right]$ & $E_G \, \mesunt{\giga\joule}$ & $\Delta E_G \left[\%\right]$\\ 
   \midrule
  \input{macro/energy_com_const_gains.tex}
  \end{tabular}
  \label{tab:error_KoptGE}
\end{table}

The resulting static power curves has been reported in \autoref{fig:Kopt_GE_PGE}.
\begin{figure}
  \centering
  \includegraphics[width=0.7\columnwidth]{images/vectorial/2023_11_14_20_41_07fig_electrical_power_param_zoom.eps}
  \caption{Electrical power output of the generator for different values of $K_{opt,GE}$. The values of $K_{opt,GE}$ used in each simulation are the ones reported in \autoref{tab:error_KoptGE}.}
  \label{fig:Kopt_GE_PGE}
\end{figure}

From the graphs reported in \autoref{fig:Kopt_GE_PGE} it could be seen that the gain used in the first three simulations provide a power curve that is quite close to the fourth one (i.e. the optimal) in the below rated region. On the other hand, once the rated WS is reached, then the power command is below the saturation and so the rated power is not reached. The committed errors in this zone are highly influenced by the above rated mismatch. \\
For what concerns the last three simulations, the error committed in the below rated region is higher (as could be seen in the figure) but the saturation of the power is reached, and so the overall error is lower than the first cases. \\
From this simulation can be seen that the optimal gain is the one computed previously, and each deviation produces a degradation of the power curve. On the other hand, an overestimation of the gain is less worse than an underestimation, because in the latter case the saturation of the generator's torque command and so the output power is not achieved.

\newpage